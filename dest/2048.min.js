/*! 2048 2014-11-10 */
define("index/2048/main2048",["support2048","touch","showanimation2048"],function(e,t){function n(){for(var e=0;4>e;e++)for(var t=0;4>t;t++){var n=document.getElementById("grid-cell-"+e+"-"+t);n.style.top=d.getPosTop(e,t)+"px",n.style.left=d.getPosLeft(e,t)+"px"}for(e=0;4>e;e++)for(g[e]=[],w[e]=[],t=0;4>t;t++)g[e][t]=0,w[e][t]=!1;o(),y=0,document.getElementById("score").innerHTML=y}function o(){for(var e=document.getElementById("grid-container"),t=document.getElementsByClassName("number-cell"),n=t.length-1;n>=0;n--)e.removeChild(t[n]);for(var o=0;4>o;o++)for(var r=0;4>r;r++){var i=document.createElement("div");i.className="number-cell",i.id="number-cell-"+o+"-"+r,e.appendChild(i);var s,a=document.getElementById("number-cell-"+o+"-"+r);0==g[o][r]?(a.style.width="0px",a.style.height="0px",a.style.top=d.getPosTop(o,r)+50+"px",a.style.left=d.getPosLeft(o,r)+50+"px",a.style.fontSize="20px"):(s=d.getNumberText(g[o][r]),a.style.width="60px",a.style.height="60px",a.style.top=d.getPosTop(o,r)+"px",a.style.left=d.getPosLeft(o,r)+"px",a.style.backgroundColor=d.getNumberBackgroundColor(g[o][r]),a.style.color=d.getNumberColor(g[o][r]),a.innerHTML=s,a.style.fontSize=d.getFontSize(s)),w[o][r]=!1}}function r(){if(d.nospace(g))return!1;for(var e=parseInt(Math.floor(4*Math.random())),t=parseInt(Math.floor(4*Math.random())),n=0;50>n&&0!=g[e][t];)e=parseInt(Math.floor(4*Math.random())),t=parseInt(Math.floor(4*Math.random())),n++;if(50==n)for(var o=0;4>o;o++)for(var r=0;4>r;r++)0==g[o][r]&&(e=o,t=r);var i=.5>Math.random()?2:4;return g[e][t]=i,p.showNumberWithAnimation(e,t,i),!0}function i(e){"left"==e&&u()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300)),"up"==e&&m()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300)),"right"==e&&c()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300)),"down"==e&&f()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300))}function s(){d.nospace(g)&&l(g)&&a()}function a(){var e=document.getElementById("gameover");e.style.display="box",e.style.display="-ms-box",e.style.display="-webkit-box",e.style.display="-moz-box"}function u(){if(!d.canMoveLeft(g))return!1;for(var e=0;4>e;e++)for(var t=1;4>t;t++)if(0!=g[e][t])for(var n=0;t>n;n++){if(0==g[e][n]&&d.noBlockHorizontal(e,n,t,g)){p.showMoveAnimation(e,t,e,n),g[e][n]=g[e][t],g[e][t]=0;break}if(g[e][n]==g[e][t]&&d.noBlockHorizontal(e,n,t,g)&&!w[e][n]){p.showMoveAnimation(e,t,e,n),g[e][n]+=g[e][t],g[e][t]=0,y+=g[e][n],p.updateScore(y),w[e][n]=!0;break}}return setTimeout("updateBoardView()",200),!0}function c(){if(!d.canMoveRight(g))return!1;for(var e=0;4>e;e++)for(var t=2;t>=0;t--)if(0!=g[e][t])for(var n=3;n>t;n--){if(0==g[e][n]&&d.noBlockHorizontal(e,t,n,g)){p.showMoveAnimation(e,t,e,n),g[e][n]=g[e][t],g[e][t]=0;break}if(g[e][n]==g[e][t]&&d.noBlockHorizontal(e,t,n,g)&&!w[e][n]){p.showMoveAnimation(e,t,e,n),g[e][n]+=g[e][t],g[e][t]=0,y+=g[e][n],p.updateScore(y),w[e][n]=!0;break}}return setTimeout("updateBoardView()",200),!0}function m(){if(!d.canMoveUp(g))return!1;for(var e=0;4>e;e++)for(var t=1;4>t;t++)if(0!=g[t][e])for(var n=0;t>n;n++){if(0==g[n][e]&&d.noBlockVertical(e,n,t,g)){p.showMoveAnimation(t,e,n,e),g[n][e]=g[t][e],g[t][e]=0;break}if(g[n][e]==g[t][e]&&d.noBlockVertical(e,n,t,g)&&!w[n][e]){p.showMoveAnimation(t,e,n,e),g[n][e]+=g[t][e],g[t][e]=0,y+=g[n][e],p.updateScore(y),w[n][e]=!0;break}}return setTimeout("updateBoardView()",200),!0}function f(){if(!d.canMoveDown(g))return!1;for(var e=0;4>e;e++)for(var t=2;t>=0;t--)if(0!=g[t][e])for(var n=3;n>t;n--){if(0==g[n][e]&&d.noBlockVertical(e,t,n,g)){p.showMoveAnimation(t,e,n,e),g[n][e]=g[t][e],g[t][e]=0;break}if(g[n][e]==g[t][e]&&d.noBlockVertical(e,t,n,g)&&!w[n][e]){p.showMoveAnimation(t,e,n,e),g[n][e]+=g[t][e],g[t][e]=0,y+=g[n][e],p.updateScore(y),w[n][e]=!0;break}}return setTimeout("updateBoardView()",200),!0}function l(e){return d.canMoveLeft(e)||d.canMoveRight(e)||d.canMoveUp(e)||d.canMoveDown(e)?!1:!0}var h,d=e("support2048"),v=e("touch"),p=e("showanimation2048"),g=[],y=0,w=[];h=document.getElementById("grid-container"),window.generateOneNumber=r,window.updateBoardView=o,window.isgameover=s,t.newgame=function(){n(),document.getElementById("gameover").style.display="none",r(),r(),v.init(h,i)},document.onkeydown=function(e){switch(e.keyCode){case 37:u()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300));break;case 38:m()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300));break;case 39:c()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300));break;case 40:f()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300));break;default:}}}),define("index/2048/showanimation2048",["support2048"],function(e,t){var n=e("support2048");t.showNumberWithAnimation=function(e,t,o){var r=document.getElementById("number-cell-"+e+"-"+t),i=n.getNumberText(o);r.style.backgroundColor=n.getNumberBackgroundColor(o),r.style.color=n.getNumberColor(o),r.innerHTML=i,r.style.fontSize=n.getFontSize(i),r.style.transition="width 80ms, height 80ms, top 80ms, left 80ms",r.style.webkitTransition="width 80ms, height 80ms, top 80ms, left 80ms",r.style.mozTransition="width 80ms, height 80ms, top 80ms, left 80ms",r.style.width="60px",r.style.height="60px",r.style.top=n.getPosTop(e,t)+"px",r.style.left=n.getPosLeft(e,t)+"px"},t.showMoveAnimation=function(e,t,o,r){var i=document.getElementById("number-cell-"+e+"-"+t);i.style.transition="top 100ms, left 100ms",i.style.webkitTransition="top 100ms, left 100ms",i.style.mozTransition="top 100ms, left 100ms",i.style.top=n.getPosTop(o,r)+"px",i.style.left=n.getPosLeft(o,r)+"px"},t.updateScore=function(e){document.getElementById("score").innerHTML=e}}),define("index/2048/support2048",[],function(e,t){t.getPosTop=function(e){return 10+70*e},t.getPosLeft=function(e,t){return 10+70*t},t.getNumberBackgroundColor=function(e){switch(e){case 2:return"#eee4da";case 4:return"#ede0c8";case 8:return"#f2b179";case 16:return"#f59563";case 32:return"#f67c5f";case 64:return"#f65e3b";case 128:return"#edcf72";case 256:return"#edcc61";case 512:return"#9c0";case 1024:return"#33b5e5";case 2048:return"#09c";case 4096:return"#a6c";case 8192:return"#93c"}return"black"},t.getNumberColor=function(e){return 4>=e?"#776e65":"white"},t.getNumberText=function(e){switch(e){case 2:return"小白";case 4:return"实习生";case 8:return"程序猿";case 16:return"项目经理";case 32:return"架构师";case 64:return"技术经理";case 128:return"高级经理";case 256:return"技术总监";case 512:return"副总裁";case 1024:return"CTO";case 2048:return"总裁";case 4096:return"#a6c";case 8192:return"#93c"}return"black"},t.getFontSize=function(e){switch(e.length){case 1:return"30px";case 2:return"20px";case 3:return"14px";case 4:return"18px";case 5:return"14px"}return"14px"},t.nospace=function(e){for(var t=0;4>t;t++)for(var n=0;4>n;n++)if(0==e[t][n])return!1;return!0},t.canMoveLeft=function(e){for(var t=0;4>t;t++)for(var n=1;4>n;n++)if(0!=e[t][n]&&(0==e[t][n-1]||e[t][n-1]==e[t][n]))return!0;return!1},t.canMoveRight=function(e){for(var t=0;4>t;t++)for(var n=2;n>=0;n--)if(0!=e[t][n]&&(0==e[t][n+1]||e[t][n+1]==e[t][n]))return!0;return!1},t.canMoveUp=function(e){for(var t=0;4>t;t++)for(var n=1;4>n;n++)if(0!=e[n][t]&&(0==e[n-1][t]||e[n-1][t]==e[n][t]))return!0;return!1},t.canMoveDown=function(e){for(var t=0;4>t;t++)for(var n=2;n>=0;n--)if(0!=e[n][t]&&(0==e[n+1][t]||e[n+1][t]==e[n][t]))return!0;return!1},t.noBlockHorizontal=function(e,t,n,o){for(var r=t+1;n>r;r++)if(0!=o[e][r])return!1;return!0},t.noBlockVertical=function(e,t,n,o){for(var r=t+1;n>r;r++)if(0!=o[r][e])return!1;return!0}}),define("index/2048/touch",[],function(e,t){var n={events:{index:0,el:null,swipeTime:2e3,startPos:null,endPos:null,direct:"",endFunction:null,_hasTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,handleEvent:function(e){var t=this;e.preventDefault(),e.stopPropagation(),"touchstart"==e.type||"mousedown"==e.type?t.start(e):"touchmove"==e.type||"mousemove"==e.type?t.move(e):("touchend"==e.type||"mouseup"==e.type)&&t.end(e)},start:function(e){var t=e,n="mousemove",o="mouseup";if(this._hasTouch&&e.targetTouches.length>0)t=e.targetTouches[0],n="touchmove",o="touchend";else if(this._hasTouch)return;this.startPos={x:t.pageX,y:t.pageY,time:+new Date},this.el.addEventListener(n,this,!1),this.el.addEventListener(o,this,!1)},move:function(e){if(!this._hasTouch||!(event.targetTouches.length>1||event.scale&&1!==event.scale)){var t=e;if(this._hasTouch&&e.targetTouches.length>0)t=e.targetTouches[0];else if(this._hasTouch)return;this.endPos={x:t.pageX,y:t.pageY,time:+new Date}}},end:function(){var e=this.endPos.time-this.startPos.time,t="mousemove",n="mouseup";this._hasTouch&&(t="touchmove",n="touchend");var o=this.endPos.x-this.startPos.x,r=this.endPos.y-this.startPos.y,i=180*Math.atan2(r,o)/Math.PI;e>this.swipeTime||5>r&&5>o||(-45>i&&i>-135?this.direct="up":i>=45&&135>i?this.direct="down":i>=135||-135>=i?this.direct="left":i>=-45&&45>=i&&(this.direct="right"),this.endFunction(this.direct),this.el.removeEventListener(t,this,!1),this.el.removeEventListener(n,this,!1))}},init:function(e,t){var n;this.events.el=e,this.events.endFunction=t,n=this,e.addEventListener("touchstart",n.events,!1),e.addEventListener("mousedown",n.events,!1)}};t.init=function(e,t){n.init(e,t)}});